<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOC Home Page</title>
    <link rel="stylesheet" type="text/css" href="/styles/form-style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=edit">
    <script src="/scripts/locedit.js" defer></script>
</head>
<body class = "body">
<!--Add header to move cards down and create a professional images-->
<!--Add two dropdown menus hegre to select which division is shown-->
    <div class = "header">
        <div class = "leftSideBar">
            <h1>Learning Outcomes Committee</h1>
        </div>
        
        <div class="rightSideBar">
            <a href="/summary" role="button">Summary</a>
            <a href="/history" role="button">History</a>
        </div>
    </div>
    <% let yearChosen = ""%>
    <div class = "mainSection">
        <div class="card-grid" id="cardContainer">
            <select name="yearChoice" id="years">
                <option disabled hidden selected>Choose a year</option>
                <% Object.entries(Data).forEach(([year]) => { %>
                    <option value="<%=year%>"><%=year%></option>
                <%})%>
            </select>
            <select value="divChoice" id="divs">
                <option selected>All Divisions</option>
                <% Object.entries(Data).forEach(([year, divisions]) => { %>
                    <% Object.entries(divisions).forEach(([division, info]) => { %>
                        <option hidden value="<%= division %>" data-year="<%= year %>">
                            <%= division %>
                        </option>
                    <% }) %>
                <% }) %>
            </select>
            <% Object.entries(Data).forEach(([year, divisions]) => { %>
                <div id="<%=year%>" class = "singlecard">
                    <!-- <h2 class="YearCard"><%= year %></h2> -->
                    <% Object.entries(divisions).forEach(([division, info]) => { %>
                        <div class="division-card" data-division="<%= division %>">
                            <h3 class="divison-card"><%= division %></h3>
                            <p>Division Chair: <span class="editable" name = "Division Chair" data-field="DivisionChair"><%= info.DivisionChair %></span></p>
                            <p>Dean: <span class="editable" name = "Dean" data-field="Dean"><%= info.Dean %></span></p>
                            <p>LOC Rep: <span class="editable" name = "LOC Rep" data-field="LOCRep"><%= info.LOCRep %></span></p>
                            <p>PEN Contact: <span class="editable" name = "PEN Contact" data-field="PENContact"><%= info.PENContact %></span></p>

                            <div class="edit-controls">
                                <button class="edit-btn">Edit</button>
                                <button class="save-btn" style="display:none;">Save</button>
                                <button class="cancel-btn" style="display:none;">Cancel</button>
                            </div>
                            <div class="error-message"></div>
                        </div>

                        <% if (info.Summary) { %>
                            <div class="summary-section">
                              <% Object.entries(info.Summary).forEach(([subject, details]) => { %>
                                <div class="subject-card" data-division="<%= division %>">
                                  <h3><%= subject %></h3>
                                  <p><strong>Has Been Paid:</strong> <span class="editable" name = "Payment status" data-field="HasBeenPaid"><%= details.HasBeenPaid %></span></p>
                                  <p><strong>Report Submitted:</strong> <span class="editable" name = "Report Status" data-field="ReportSubmitted"><%= details.ReportSubmitted %></span></p>
                                  <p><strong>Notes:</strong> <span class="editable" name = "Notes" data-field="Notes"><%= details.Notes %></span></p>
                                  <% if (details.Payees) { %>
                                    <h3>Payees:</h3>
                                    <div id="PayeeHolder">
                                        <% Object.entries(details.Payees).forEach(([name, amount]) => { %>
                                            <p class="editable-payee" data-name="<%= name %>"><%= name %> | <%= amount.toFixed(2) %></p>
                                        <% }) %>
                                    </div>
                                  <% } %>

                                    <div class="edit-controls">
                                        <button class="edit-btn">Edit</button>
                                        <button class="save-btn" style="display:none;">Save</button>
                                        <button class="cancel-btn" style="display:none;">Cancel</button>
                                    </div>
                                    <div class="error-message"></div>
                                </div>

                              <% }) %>
                            </div>
                          <% } %>
                    <%})%>
                </div>
                <%})%>
            </div>
        </div>
        <script>
            const selector = document.getElementById("years");
            const sections = document.querySelectorAll(".singlecard");
            const divSelect = document.getElementById("divs");
    
            sections.forEach(sec => sec.style.display = "none");
        
            selector.addEventListener("change", () => {
                const chosen = selector.value;
        
                sections.forEach(sec => {
                    sec.style.display = sec.id === chosen ? "grid" : "none";
                });
            });

            selector.addEventListener("change", () => {
                const chosen = selector.value;

                [...divSelect.options].forEach(opt => {
                    if (opt.value === "All Divisions") return;

                    opt.style.display = (opt.dataset.year === chosen) ? "block" : "none";
                });
            });

            
            const divSelector = document.getElementById("divs");
            const subjectCards = document.querySelectorAll(".subject-card");
            const divisionCards = document.querySelectorAll(".division-card");

            divSelector.addEventListener("change", () => {
                const chosenDiv = divSelector.value;

                divisionCards.forEach(card => {
                    const matches = chosenDiv === "All Divisions" || card.dataset.division === chosenDiv;
                    card.style.display = matches ? "block" : "none";
                });

                subjectCards.forEach(card => {
                    const matches = chosenDiv === "All Divisions" || card.dataset.division === chosenDiv;
                    card.style.display = matches ? "block" : "none";
                });
            });
        </script>
</body>
</html>